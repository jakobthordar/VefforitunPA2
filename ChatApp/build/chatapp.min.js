var app=angular.module("ChatApp",["ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/home.html",controller:"LoginController"}).when("/room/:roomName",{templateUrl:"templates/room.html",controller:"RoomController"}).when("/menu",{templateUrl:"templates/menu.html",controller:"MenuController"}).otherwise({redirectTo:"/"})}]),app.controller("LoginController",["$scope","$location","SocketService",function(a,b,c){a.username="",a.message="";var d=io.connect("http://localhost:8080");a.connect=function(){d&&d.emit("adduser",a.username,function(e){e?(c.setConnected(d),c.setUsername(a.username),b.path("/menu")):a.message="Your name is taken, please choose another",a.$apply()})}}]),app.controller("RoomController",["$scope","$location","$routeParams","SocketService","$timeout",function(a,b,c,d){a.roomName=c.roomName,a.currentMessage="",a.users=[];var e=d.getSocket(),f=function(b){a.users=b};e&&(e.emit("joinroom",{room:a.roomName,pass:""},function(){}),e.on("updatechat",function(b,c){console.log(c),a.messages=c,a.$apply()}),e.on("updateusers",function(b,c,e){if(b===a.roomName){var g=[];for(var h in c)g.push(h),console.log("User: "+h);for(var i in e)g.push(i),d.setUserOp(b,i),console.log("Op: "+i);console.log(d.isUserOp(b)===!0?"Yay im an op!":"I'm not an op :("),f(g),console.log("End of user list")}a.$apply()})),a.leave=function(){e&&(console.log("You are leaving the room: "+a.roomName),e.emit("partroom",a.roomName),b.path("/menu"))},a.send=function(){e&&(console.log("I sent a message to "+a.roomName+": "+a.currentMessage),e.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage}),a.currentMessage="")},a.keyPress=function(b){13===b.keyCode&&a.send()}}]),app.controller("MenuController",["$scope","$location","$routeParams","SocketService","$timeout",function(a,b,c,d){a.rooms=[];var e=d.getSocket(),f=function(b){a.rooms=b};e&&(e.emit("rooms"),e.on("roomlist",function(b){var c=[];for(var d in b)c.push(d);f(c),a.$apply()}),a.join=function(){console.log("I am joining the room "+a.roomname),b.path("/room/"+a.roomname)}),a.keyPress=function(b){13===b.keyCode&&a.send()}}]),app.factory("SocketService",["$http",function(){var a,b="",c="",d=!1;return{setConnected:function(b){a=b},setUsername:function(a){b=a},setUserOp:function(a,e){e==b&&(c=a,d=!0)},getUsername:function(){return b},getSocket:function(){return a},isUserOp:function(a){return c==a&&d===!0?!0:!1}}}]);