var app=angular.module("ChatApp",["ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/home.html",controller:"LoginController"}).when("/room/:roomName",{templateUrl:"templates/room.html",controller:"RoomController"}).when("/menu",{templateUrl:"templates/menu.html",controller:"MenuController"}).otherwise({redirectTo:"/"})}]),app.controller("LoginController",["$scope","$location","SocketService",function(a,b,c){a.username="",a.message="";var d=io.connect("http://localhost:8080");a.connect=function(){d&&d.emit("adduser",a.username,function(e){e?(c.setConnected(d),c.setUsername(a.username),b.path("/menu")):a.message="Your name is taken, please choose another",a.$apply()})},a.keyPress=function(b){13===b.keyCode&&a.connect()}}]),app.controller("RoomController",["$scope","$location","$routeParams","SocketService","$timeout",function(a,b,c,d){a.roomName=c.roomName,a.currentMessage="",a.users=[],a.messages={};var e=d.getSocket(),f=function(b){a.users=b};e&&(d.isUserBanned(a.roomName)===!1?e.emit("joinroom",{room:a.roomName,pass:""},function(){}):(b.path("/menu/"),d.setBanMessage(a.roomName),console.log("Oops, you have been banned from the room. Shame on you!"),e.emit("partroom",a.roomName)),e.on("updatechat",function(b,c){console.log("test: "+c),a.messages=c,a.$apply()}),e.on("kicked",function(a,c,e){console.log("Kicking: "+c),console.log("Sockerservice name: "+d.getUsername()),d.getUsername()==c&&(console.log("You just got kicked by: "+e),b.path("/menu"))}),e.on("banned",function(a,c,e){console.log("Banning: "+c),console.log("Sockerservice name: "+d.getUsername()),d.getUsername()==c&&(d.setUserBanned(a),console.log("You just got banned by: "+e),b.path("/menu"))}),e.on("unbanned",function(a,b){console.log("Unbanning: "+b),console.log("Socketservice name: "+d.getUsername()),d.getUsername()==b&&(d.removeUserBanned(a),console.log("You have been removed from the banned user list"))}),e.on("updateusers",function(b,c,e){if(b===a.roomName){var g=[];for(var h in c)g.push(h),console.log("User: "+h);for(var i in e)g.push(i),d.setUserOp(b,i),console.log("Op: "+i);console.log(d.isUserOp(b)===!0?"Yay im an op!":"I'm not an op :("),f(g)}a.$apply()}),e.on("recv_privatemsg",function(b,c){console.log("Received private message: "+c+" from user: "+b),a.messages.push({message:c,nick:b+" sent (private): ",timestamp:new Date}),a.$apply()}),a.send=function(){if("/send"==a.currentMessage.substring(0,5)||"/t"==a.currentMessage.substring(0,2)){console.log("Inside private message");var b=a.currentMessage.split(" ")[1],c=a.currentMessage.split(" ").splice(2).join(" ");console.log("I sent a private message to "+b+": "+c),e.emit("privatemsg",{nick:b,message:c},function(){}),a.messages.push({message:c,nick:"You sent (private): ",timestamp:new Date})}else if("/kick"==a.currentMessage.substring(0,5)||"/k"==a.currentMessage.substring(0,2))if(d.isUserOp(a.roomName)===!0){console.log("Kicking");var f=a.currentMessage.split(" ")[1];console.log("I just kicked "+f),e.emit("kick",{user:f,room:a.roomName},function(){})}else console.log("You can't kick someone if you are not OP");else if("/ban"==a.currentMessage.substring(0,4)||"/b"==a.currentMessage.substring(0,2))if(d.isUserOp(a.roomName)===!0){console.log("Banning");var g=a.currentMessage.split(" ")[1];console.log("I just banned "+g),e.emit("ban",{user:g,room:a.roomName},function(){})}else console.log("You can't ban someone if you are not OP");else if("/unban"==a.currentMessage.substring(0,6)||"/ub"==a.currentMessage.substring(0,3)){if(d.isUserOp(a.roomName)===!0){console.log("Unbanning");var h=a.currentMessage.split(" ")[1];console.log("I just unbanned "+h),e.emit("unban",{user:h,room:a.roomName},function(){})}}else console.log("I sent a message to "+a.roomName+": "+a.currentMessage),e.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage});a.currentMessage=""},a.leave=function(){e&&(console.log("You are leaving the room: "+a.roomName),e.emit("partroom",a.roomName),b.path("/menu"))}),a.keyPress=function(b){13===b.keyCode&&a.send()}}]),app.controller("MenuController",["$scope","$location","$routeParams","SocketService","$timeout",function(a,b,c,d,e){a.rooms=[];var f=d.getSocket();a.banMessage="";var g=function(b){a.rooms=b},h=function(){a.banMessage=d.getBanMessage()};if(e(h,200),f){f.emit("rooms"),h(),f.on("roomlist",function(b){var c=[];for(var d in b)c.push(d);g(c),a.$apply()}),f.on("unbanned",function(a,b){console.log("Unbanning: "+b),console.log("Socketservice name: "+d.getUsername()),d.getUsername()==b&&(d.removeUserBanned(a),console.log("You have been removed from the banned user list"))});{d.getUserBannedList(a.roomname)}a.join=function(){console.log("I am joining the room "+a.roomname),b.path("/room/"+a.roomname)}}a.keyPress=function(b){13===b.keyCode&&a.join()}}]),app.factory("SocketService",["$http",function(){var a,b="",c="",d=[],e=!1,f="";return{setConnected:function(b){a=b},setUsername:function(a){b=a},setUserOp:function(a,d){d==b&&(c=a,e=!0)},setUserBanned:function(a){d.push(a)},removeUserBanned:function(a){var b=d.indexOf(a);0>=b&&d.splice(b,1)},getUsername:function(){return b},getSocket:function(){return a},getUserBannedList:function(){return d},isUserBanned:function(a){return d.indexOf(a)<0?!1:!0},isUserOp:function(a){return c==a&&e===!0?!0:!1},setBanMessage:function(a){f=a},getBanMessage:function(){var a="";return""!==f&&(a="You have been banned from: "+f,f=""),a}}}]);